{"version":3,"file":"voice.js","sources":["../../svelte-app/src/components/Typewriter.svelte","../../svelte-app/src/components/VoiceRecognition.svelte","../../svelte-app/src/Voice.svelte","../../svelte-app/src/voice.js"],"sourcesContent":["<script>\n    export let text = \"\";\n    let displayedText = \"\";\n    let interval;\n\n    // textが更新されるたびにtypewrite関数を呼び出す\n    $: if (text) {\n        displayedText = \"\"; // 既存のテキストをクリア\n        clearInterval(interval); // 既存のインターバルをクリア\n        typewrite(); // 新しいテキストでタイプライトを開始\n    }\n\n    function typewrite() {\n        let index = 0;\n        const interval = setInterval(() => {\n            if (index < text.length) {\n                displayedText += text[index++];\n            } else {\n                clearInterval(interval);\n            }\n            console.log(text.length);\n        }, 100); // 100ミリ秒ごとに文字を追加\n    }\n\n    // onMount(typewrite);\n</script>\n\n<div class=\"main\">\n    <div class=\"indicator\"></div>\n    <h3 class=\"title\">AIからの回答</h3>\n    <div class=\"typewriter\">{displayedText}</div>\n</div>\n\n<style>\n    .main {\n        position: relative;\n        max-width: 700px;\n        background-color: #57c4e5;\n        margin: 32px;\n        padding: 16px;\n        border-radius: 8px;\n        color: white;\n        font-family: \"Roboto\", sans-serif;\n    }\n\n    .indicator {\n        position: absolute;\n        top: -12px;\n        left: 12px;\n        width: 20px;\n        height: 20px;\n        background-color: #57c4e5;\n        transform: rotate(45deg);\n    }\n\n    .title {\n        color: #ffcc00;\n        font-size: 1.125rem; /* 18px */\n    }\n    .typewriter {\n        font-family: \"Courier New\", monospace;\n        white-space: pre-wrap;\n        overflow-wrap: break-word;\n        font-size: x-large;\n    }\n</style>\n","<script>\n    import { Button } from \"sveltestrap\";\n    import Spinner from \"./Spinner.svelte\";\n    import Typewriter from \"./Typewriter.svelte\";\n    import { generatedText, isLoading } from \"./stores.js\";\n\n    let audio;\n    let isRecording = false;\n    let mediaRecorder;\n    let audioChunks = [];\n    let isExplanationShow = true;\n    let isAnswerShow = false;\n    async function startRecording() {\n        if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {\n            console.error(\"getUserMedia not supported on your browser!\");\n            return;\n        }\n        const stream = await navigator.mediaDevices.getUserMedia({\n            audio: true,\n        });\n        mediaRecorder = new MediaRecorder(stream);\n        mediaRecorder.ondataavailable = (e) => {\n            audioChunks.push(e.data);\n        };\n        mediaRecorder.onstop = sendToServer;\n        mediaRecorder.start();\n        isRecording = true;\n        audio.play();\n    }\n\n    function stopRecording() {\n        if (!mediaRecorder) return;\n        mediaRecorder.stop();\n        isRecording = false;\n        mediaRecorder.stream.getTracks().forEach((track) => track.stop());\n        audio.play();\n    }\n\n    async function sendToServer() {\n        isLoading.set(true);\n        // generatedText.set(\"\");\n\n        const audioBlob = new Blob(audioChunks, { type: \"audio/webm\" });\n        const formData = new FormData();\n        formData.append(\"audio\", audioBlob);\n        const response = await fetch(\"/voice/upload\", {\n            method: \"POST\",\n            body: formData,\n        });\n        const result = await response.json();\n        console.log(\"answer:\", result.answer);\n        audioChunks = []; // Reset chunks after sending\n        isLoading.set(false);\n        isExplanationShow = false;\n        isAnswerShow = true;\n        generatedText.set(result.answer);\n    }\n</script>\n\n<Spinner />\n\n<div class=\"flex\">\n    <h1 class=\"text-white font-roboto text-3xl mb-4\">\n        AIに質問をしてみましょう\n    </h1>\n    <audio bind:this={audio} src=\"/static/sounds/voice_recognition.mp3\"></audio>\n    <Button\n        color={isRecording ? \"danger\" : \"primary\"}\n        outline={false}\n        on:click={isRecording ? stopRecording : startRecording}\n        class=\"custom-button\"\n        style=\"display: flex; align-items: center; justify-content: center; border-radius: 50%;\"\n    >\n        <i class=\"fa-solid fa-microphone\"></i>\n    </Button>\n    {#if isExplanationShow}\n        <p class=\"mt-2 font-roboto text-white\">\n            音声入力を開始するにはマイクアイコンをクリックしてください。\n        </p>\n    {/if}\n    {#if isAnswerShow}\n        <Typewriter text={$generatedText} />\n    {/if}\n</div>\n\n<style>\n    .flex {\n        display: flex;\n        flex-direction: column;\n        align-items: center;\n        justify-content: center;\n        height: 100vh;\n        background-color: #2f855a;\n    }\n    .text-white {\n        color: white;\n    }\n    .font-roboto {\n        font-family: \"Roboto\", sans-serif;\n    }\n    :global(.custom-button) {\n        width: 100px;\n        height: 100px;\n    }\n</style>\n","<script>\n    import Menu from \"./components/Menu.svelte\";\n    import VoiceRecognition from \"./components/VoiceRecognition.svelte\";\n</script>\n\n<div class=\"menu-area\">\n    <Menu />\n</div>\n<VoiceRecognition></VoiceRecognition>\n\n<style>\n    .menu-area {\n        position: absolute; /* 位置を絶対位置で指定 */\n        right: 10px; /* 右端から0pxの位置 */\n        top: 5px; /* 上端から0pxの位置 */\n        z-index: 1000; /* 他の要素の上に表示 */\n    }\n</style>\n","import App from './Voice.svelte';\n\nconst app = new App({\n\ttarget: document.body,\n});\n\nexport default app;"],"names":["App"],"mappings":"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"}